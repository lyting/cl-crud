<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Example</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="../dist/cl-crud.min.js"></script>
    <style>
      html,
      body,
      #app {
        height: 100vh;
        width: 100vw;
      }

      * {
        padding: 0;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <cl-crud @load="onLoad">
        <template #slot-append>
          <el-button type="text" size="mini" @click="openForm_Loading">测试loading</el-button>
        </template>

        <template #slot-validate="{scope}">
          <el-form-item
            v-for="(item, index) in scope.vads"
            :key="index"
            :prop="'vads.' + index + '.val'"
            :rules="{ required: true }"
          >
            <el-input v-model="item.val"></el-input>
          </el-form-item>

          <el-button @click="addVad(scope.vads)">添加行</el-button>
        </template>
      </cl-crud>
      <cl-form ref="cl-form"></cl-form>
    </div>

    <script>
      Vue.use(CRUD);

      new Vue({
        el: '#app',

        data() {
          return {
            vad: {
              list: []
            }
          };
        },

        methods: {
          onLoad({ ctx, app }) {
            ctx
              .service({
                page: p => {
                  console.log('page', p);
                  return Promise.resolve({
                    list: [
                      {
                        id: 1,
                        name: '刘一',
                        process: 42.2,
                        endTime: '2019年09月02日',
                        price: 75.99,
                        salesRate: 52.2,
                        salesStatus: 1
                      },
                      {
                        id: 2,
                        name: '陈二',
                        process: 35.2,
                        endTime: '2019年09月05日',
                        price: 242.1,
                        salesRate: 72.1,
                        salesStatus: 1
                      },
                      {
                        id: 3,
                        name: '张三',
                        process: 10.2,
                        endTime: '2019年09月12日',
                        price: 74.11,
                        salesRate: 23.9,
                        salesStatus: 0
                      },
                      {
                        id: 4,
                        name: '李四',
                        process: 75.5,
                        endTime: '2019年09月13日',
                        price: 276.64,
                        salesRate: 47.2,
                        salesStatus: 0
                      },
                      {
                        id: 5,
                        name: '王五',
                        process: 25.4,
                        endTime: '2019年09月18日',
                        price: 160.23,
                        salesRate: 28.3,
                        salesStatus: 1
                      },
                      {
                        id: 6,
                        name: '赵六',
                        process: 9.8,
                        endTime: '2019年09月20日',
                        price: 219.52,
                        salesRate: 24.4,
                        salesStatus: 0
                      }
                    ],
                    pagination: {
                      page: 1,
                      size: 20,
                      total: 6
                    }
                  });
                },
                info: d => {
                  console.log('info', d);
                  return Promise.resolve();
                },
                add: d => {
                  console.log('add', d);
                  return Promise.resolve();
                },
                delete: d => {
                  console.log('delete', d);
                  return Promise.resolve();
                },
                update: d => {
                  console.log('update', d);
                  return Promise.resolve();
                }
              })
              .set('table', {
                columns: [
                  {
                    type: 'selection',
                    align: 'center',
                    width: 60
                  },
                  {
                    label: '花名',
                    prop: 'name',
                    align: 'center'
                  },
                  {
                    label: '进展',
                    prop: 'process',
                    align: 'center'
                  },
                  {
                    label: '总量',
                    prop: 'price',
                    align: 'center'
                  },
                  {
                    label: '销售',
                    prop: 'salesRate',
                    align: 'center'
                  },
                  {
                    label: '最后期限',
                    prop: 'endTime',
                    align: 'center'
                  }
                ],

                op: {
                  props: {
                    width: 200
                  },

                  layout: ['slot-append', 'edit', 'delete']
                }
              })
              .set('upsert', {
                props: {
                  labelWidth: '150px'
                },
                items: [
                  {
                    prop: 'vads',
                    value: [],
                    label: '动态增减表单验证',
                    component: {
                      name: 'slot-validate'
                    }
                  },
                  {
                    label: '输入框',
                    prop: 'a',
                    component: {
                      name: 'el-input',
                      attrs: {
                        placeholder: '请输入关键字'
                      }
                    }
                  },
                  {
                    label: '下拉选择',
                    prop: 'b',
                    value: [1, 2],
                    component: {
                      name: 'el-select',
                      props: {
                        multiple: true
                      },
                      options: [
                        {
                          label: '选项1',
                          value: 1
                        },
                        {
                          label: '选项2',
                          value: 2
                        }
                      ]
                    }
                  },
                  {
                    label: '时间',
                    prop: 'c',
                    component: {
                      name: 'el-date-picker'
                    }
                  },
                  {
                    label: '多选',
                    prop: 'd',
                    value: [1],
                    component: {
                      name: 'el-checkbox-group',
                      options: [
                        {
                          label: '选项1',
                          value: 1
                        },
                        {
                          label: '选项2',
                          value: 2
                        }
                      ]
                    }
                  }
                ]
              })
              .set('search', {
                adv: {
                  items: [
                    {
                      label: '输入框',
                      prop: 'a',
                      component: {
                        name: 'el-input',
                        attrs: {
                          placeholder: '请输入关键字'
                        }
                      }
                    },
                    {
                      label: '下拉选择',
                      prop: 'b',
                      value: [1, 2],
                      component: {
                        name: 'el-select',
                        props: {
                          multiple: true
                        },
                        options: [
                          {
                            label: '选项1',
                            value: 1
                          },
                          {
                            label: '选项2',
                            value: 2
                          }
                        ]
                      }
                    },
                    {
                      label: '时间',
                      prop: 'c',
                      component: {
                        name: 'el-date-picker'
                      }
                    },
                    {
                      label: '多选',
                      prop: 'd',
                      value: [1],
                      component: {
                        name: 'el-checkbox-group',
                        options: [
                          {
                            label: '选项1',
                            value: 1
                          },
                          {
                            label: '选项2',
                            value: 2
                          }
                        ]
                      }
                    }
                  ]
                },

                query: {
                  list: [
                    {
                      label: '上升的',
                      value: 1
                    },
                    {
                      label: '下跌的',
                      value: 0
                    }
                  ]
                }
              })
              .done();
            app.refresh();
          },

          openForm_Loading() {
            const $ = this.$refs['cl-form'].open({
              props: {
                title: '测试loading',
                width: '500px'
              },

              items: [
                {
                  prop: 'tl',
                  hidden: false,
                  component: {
                    name: 'test-loading',

                    data() {
                      return {
                        status: 'loading'
                      };
                    },

                    mounted() {
                      this.status = 'loading';
                      $.showLoading('加载中');

                      setTimeout(() => {
                        this.status = 'done';
                        $.hideLoading();
                      }, 1000);
                    },

                    render(h) {
                      return h('p', this.status);
                    }
                  }
                }
              ]
            });
          },

          addVad(list) {
            list.push({
              val: ''
            });
          }
        }
      });
    </script>
  </body>
</html>
